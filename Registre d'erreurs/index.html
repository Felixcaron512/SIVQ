<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ“‹ Registre des erreurs - SIVQ Portail +</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="icon" href="https://i.imgur.com/06jbFPA_d.webp" />
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-red-50 flex flex-col">

  <!-- Header -->
  <header class="relative overflow-hidden bg-gradient-to-br from-red-600 via-orange-600 to-red-700">
    <div class="absolute inset-0 opacity-20 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMzLjMxNCAwIDYgMi42ODYgNiA2cy0yLjY4NiA2LTYgNi02LTIuNjg2LTYtNiAyLjY4Ni02IDYtNnptMCA0MmMzLjMxNCAwIDYgMi42ODYgNiA2cy0yLjY4NiA2LTYgNi02LTIuNjg2LTYtNiAyLjY4Ni02IDYtNnpNMCAyNGMzLjMxNCAwIDYgMi42ODYgNiA2cy0yLjY4NiA2LTYgNi02LTIuNjg2LTYtNiAyLjY4Ni02IDYtNnoiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLW9wYWNpdHk9Ii4xIi8+PC9nPjwvc3ZnPg==')"></div>
    <div class="relative max-w-7xl mx-auto px-4 py-16 text-center text-white">
      <div class="flex justify-center mb-6">
        <div class="relative">
          <div class="absolute inset-0 bg-white/20 blur-2xl rounded-full"></div>
          <img src="https://i.imgur.com/06jbFPA_d.webp" alt="Logo SIVQ" class="relative h-20 w-20 object-contain">
        </div>
      </div>
      <h1 class="text-4xl sm:text-5xl font-bold mb-4">ðŸ“‹ Registre des erreurs</h1>
      <p class="text-xl text-red-100 max-w-2xl mx-auto">
        Consultez et signalez les erreurs de l'application SIVQ Portail +
      </p>
    </div>
  </header>

  <!-- Stats Section -->
  <section class="max-w-7xl mx-auto px-4 -mt-8 mb-12 grid grid-cols-1 sm:grid-cols-3 gap-4" id="stats"></section>

  <!-- Filters -->
  <section class="max-w-7xl mx-auto px-4 mb-8">
    <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col sm:flex-row gap-4 items-center">
      <div class="flex-1 relative w-full">
        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        <input id="searchInput" type="text" placeholder="Rechercher par code ou description..." class="w-full pl-10 border rounded-lg p-2 focus:ring-2 focus:ring-red-400">
      </div>
      <select id="filterSelect" class="border rounded-lg p-2 focus:ring-2 focus:ring-red-400">
        <option value="all">Toutes</option>
        <option value="Critique">Critique</option>
        <option value="Bloquante">Bloquante</option>
        <option value="Mineure">Mineure</option>
      </select>
      <button onclick="openForm()" class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 flex items-center gap-2">
        <i data-lucide="plus"></i> Ajouter
      </button>
    </div>
  </section>

  <!-- Liste des erreurs -->
  <section class="max-w-7xl mx-auto px-4 pb-20 space-y-4" id="errorList"></section>

  <!-- Formulaire Modal -->
  <div id="formModal" class="fixed inset-0 bg-black/50 hidden justify-center items-center z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-lg shadow-xl">
      <h2 class="text-xl font-semibold mb-2">Signaler une nouvelle erreur</h2>
      <p class="text-sm text-gray-500 mb-4">Remplissez les informations ci-dessous pour signaler une erreur</p>
      <form id="errorForm" action="https://formsubmit.co/fromhelix409@icloud.com" method="POST" class="space-y-4">
        <input type="hidden" name="_captcha" value="false">
        <div>
          <label class="block mb-1 font-medium">Code d'erreur</label>
          <input name="Code d'erreur" required class="border rounded-lg w-full p-2" placeholder="ERR029">
        </div>
        <div>
          <label class="block mb-1 font-medium">Description</label>
          <textarea name="Description" required rows="4" class="border rounded-lg w-full p-2" placeholder="Description complÃ¨te de l'erreur..."></textarea>
        </div>
        <div>
          <label class="block mb-1 font-medium">GravitÃ©</label>
          <select name="GravitÃ©" required class="border rounded-lg w-full p-2">
            <option value="">SÃ©lectionner</option>
            <option value="Critique">Critique</option>
            <option value="Bloquante">Bloquante</option>
            <option value="Mineure">Mineure</option>
          </select>
        </div>
        <div>
          <label class="block mb-1 font-medium">Date et heure</label>
          <input type="datetime-local" name="Date" required class="border rounded-lg w-full p-2">
        </div>
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" onclick="closeForm()" class="border px-4 py-2 rounded-lg">Annuler</button>
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">ðŸ“¨ Envoyer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-slate-900 text-white py-8 mt-auto">
    <div class="max-w-7xl mx-auto px-4 flex flex-col sm:flex-row justify-between items-center gap-4">
      <p class="text-slate-400 text-sm">Â© 2025 SIVQ (ERR Registre) â€” Tous droits rÃ©servÃ©s.</p>
      <p class="text-slate-400 text-sm">ConÃ§u par <span class="text-red-400 font-medium">FÃ©lix Caron</span></p>
    </div>
  </footer>

  <script>
    // DonnÃ©es d'erreurs
    const errors = [
      {code:"ERR001",description:"Une erreur est survenue pendant l'enregistrement du fichier sur Google Drive.",severity:"Critique",date:"2025-10-01 09:15"},
      {code:"ERR002",description:"Le fichier 'credentials.json' est introuvable.",severity:"Bloquante",date:"2025-10-01 09:17"},
      {code:"ERR003",description:"Impossible d'ouvrir la page d'authentification.",severity:"Bloquante",date:"2025-10-01 09:17"},
      {code:"ERR004",description:"Ã‰chec de la crÃ©ation du fichier d'identifiants.",severity:"Critique",date:"2025-10-01 09:50"},
      {code:"ERR005",description:"CrÃ©ation annulÃ©e par l'utilisateur.",severity:"Critique",date:"2025-10-01 09:52"},
      {code:"ERR006",description:"Ã‰chec de la crÃ©ation du fichier des personnages.",severity:"Bloquante",date:"2025-10-01 09:55"},
      {code:"ERR007",description:"CrÃ©ation annulÃ©e par l'utilisateur (Mineure).",severity:"Mineure",date:"2025-10-01 09:57"},
      {code:"ERR008",description:"Le contenu du fichier sur Drive est mal formatÃ© (JSON invalide).",severity:"Bloquante",date:"2025-10-01 10:00"},
      {code:"ERR009",description:"Impossible de charger les identifiants.",severity:"Critique",date:"2025-10-01 10:05"},
      {code:"ERR010",description:"Identifiants incorrects.",severity:"Mineure",date:"2025-10-01 10:10"},
      {code:"ERR029",description:"Erreur de connexion au serveur SIVQ Portail +.",severity:"Bloquante",date:"2025-10-15 14:30"}
    ];

    const severities = {
      "Critique": {color:"from-red-500 to-red-600", border:"border-red-500", icon:"x-circle"},
      "Bloquante": {color:"from-orange-500 to-orange-600", border:"border-orange-500", icon:"alert-triangle"},
      "Mineure": {color:"from-blue-500 to-blue-600", border:"border-blue-500", icon:"info"}
    };

    const list = document.getElementById("errorList");
    const stats = document.getElementById("stats");

    function renderStats() {
      const counts = {Critique:0, Bloquante:0, Mineure:0};
      errors.forEach(e=>counts[e.severity]++);
      stats.innerHTML = Object.entries(counts).map(([s,c])=>{
        const cfg = severities[s];
        return `
          <div class="bg-white rounded-2xl shadow-lg p-6 border-2">
            <div class="flex justify-between items-center">
              <div>
                <p class="text-sm text-slate-600 mb-1">${s}</p>
                <p class="text-3xl font-bold">${c}</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-gradient-to-br ${cfg.color} flex items-center justify-center shadow-lg">
                <i data-lucide="${cfg.icon}" class="text-white w-6 h-6"></i>
              </div>
            </div>
          </div>`;
      }).join("");
      lucide.createIcons();
    }

    function renderErrors() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const filter = document.getElementById("filterSelect").value;
      const filtered = errors.filter(e =>
        (filter === "all" || e.severity === filter) &&
        (e.code.toLowerCase().includes(search) || e.description.toLowerCase().includes(search))
      );
      if (filtered.length === 0) {
        list.innerHTML = `<div class='text-center py-16 text-slate-500'>
          <i data-lucide="alert-circle" class="w-16 h-16 mx-auto mb-4"></i>
          <p class="text-xl">Aucune erreur trouvÃ©e</p></div>`;
      } else {
        list.innerHTML = filtered.map(e=>{
          const cfg = severities[e.severity];
          return `
          <div class="bg-white rounded-xl shadow-md border-l-4 ${cfg.border} transition-all hover:shadow-lg">
            <div class="p-6">
              <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
                <div>
                  <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br ${cfg.color} flex items-center justify-center">
                      <i data-lucide="${cfg.icon}" class="text-white w-5 h-5"></i>
                    </div>
                    <div>
                      <h3 class="text-xl font-bold">${e.code}</h3>
                      <span class="inline-block text-white text-sm px-2 py-1 rounded bg-gradient-to-r ${cfg.color}">${e.severity}</span>
                    </div>
                  </div>
                  <p class="text-slate-700 mb-3">${e.description}</p>
                  <div class="flex items-center text-sm text-slate-500">
                    <i data-lucide="calendar" class="w-4 h-4 mr-1"></i>${e.date}
                  </div>
                </div>
              </div>
            </div>
          </div>`;
        }).join("");
      }
      lucide.createIcons();
    }

    function openForm(){ document.getElementById("formModal").classList.remove("hidden","opacity-0"); document.getElementById("formModal").classList.add("flex"); }
    function closeForm(){ document.getElementById("formModal").classList.add("hidden"); }

    document.getElementById("searchInput").addEventListener("input", renderErrors);
    document.getElementById("filterSelect").addEventListener("change", renderErrors);

    renderStats();
    renderErrors();
    lucide.createIcons();

    // Charger le widget 3CX
    const script = document.createElement('script');
    script.src = 'https://downloads-global.3cx.com/downloads/livechatandtalk/v1/callus.js';
    script.defer = true;
    document.body.appendChild(script);
    const callUsSelector = document.createElement('call-us-selector');
    callUsSelector.setAttribute('phonesystem-url', 'https://1657.3cx.cloud');
    callUsSelector.setAttribute('party', 'sivq');
    document.body.appendChild(callUsSelector);
  </script>
</body>
</html>
